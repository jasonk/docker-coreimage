#!/bin/bash
### Dump the environment from /srv/environment
## To display as json:
##   docker-coreimage environment --json (or -j)
## To display as bash settings
##   docker-coreimage environment --bash (or --sh or -b or -s)
## You can also find the environment variables in /srv/environment.sh
## and /srv/environment.json.  You can update these files on demand
## by running docker-coreimage environment --update
set -e

cd /srv/environment

BEFORE="Environment Variables:"
FORMAT="    %-20s %s"
AFTER=""

case "$1" in
    --bash|--sh|-b|-s)
        BEFORE=""
        FORMAT="export %s=\"%s\""
        AFTER=""
        ;;
    --json|-j)
        BEFORE="{"
        FORMAT="    \"%s\" : \"%s\","
        AFTER="}"
        ;;
    --update)
        $0 --json > /srv/environment.json
        $0 --bash > /srv/environment.sh
        ;;
esac

if [ -n "$BEFORE" ]; then echo "$BEFORE"; fi
for KEY in $(echo * | sort); do printf "$FORMAT\n" "$KEY" "$(head -1 $KEY)"; done
if [ -n "$AFTER" ]; then echo "$AFTER"; fi
